<div class="app app_component position_relative">
    <lsw-typical-title :buttons="false">
        <div class="flex_row centered">
            <div class="flex_100 pad_vertical_2">
                <span class="color_white">üìã Form-sharer</span>
            </div>
            <div class="flex_1 nowrap"
                v-if="selectedPage === 'formulario'">
                <button class="supermini"
                    v-on:click="exportarFormularioVacio">üìã Exportar preguntas ‚ÜóÔ∏è</button>
            </div>
            <div class="flex_1 nowrap"
                v-if="selectedPage === 'respuestas'">
                <button class="supermini"
                    v-on:click="exportarFormularioCumplimentado">‚úÖ Exportar respuestas ‚ÜóÔ∏è</button>
            </div>
        </div>
    </lsw-typical-title>
    <template v-if="selectedPage === 'editor'">
        <lsw-typical-title :buttons="false">
            <div class="flex_row centered color_white">
                <div class="flex_100">
                    <span>
                        <span>üìê Editor de formulario</span>
                        <span v-if="selectedEditorSubpage === 'json'"> - JSON</span>
                        <span v-if="selectedEditorSubpage === 'constructor'"> - Interfaz</span>
                    </span>
                </div>
                <template v-if="selectedEditorSubpage === 'constructor'">
                    <div class="flex_1 pad_left_1">
                        <button class="supermini"
                            v-on:click="() => {selectedEditorSubpage = 'json';}">
                            ‚¨ÖÔ∏è { }
                        </button>
                    </div>
                    <div class="flex_1 pad_left_1">
                        <button class="supermini"
                            v-on:click="() => selectPage('formulario')">
                            üìã ‚û°Ô∏è
                        </button>
                    </div>
                </template>
                <template v-if="selectedEditorSubpage === 'json'">
                    <div class="flex_1 pad_left_1">
                        <button class="supermini"
                            v-on:click="() => {saveJsonToFormulario(); selectedEditorSubpage = 'constructor';}">
                            üî® ‚û°Ô∏è
                        </button>
                    </div>
                </template>
            </div>
        </lsw-typical-title>
        <div class="pad_1"
            v-if="selectedEditorSubpage === 'json'">
            <textarea ref="editor_de_formulario_en_json"
                :style="getEditorHeightForStyles()"
                spellcheck="false"
                :value="JSON.stringify(formulario, null, 2)"></textarea>
        </div>
        <div class="pad_1"
            v-if="selectedEditorSubpage === 'constructor'">
            <div class="color_white"
                v-for="bloque, bloqueIndex in formulario"
                v-bind:key="'bloque_de_formulario_' + bloqueIndex">
                <div class="flex_row pad_bottom_1">
                    <div class="flex_100">
                        <div class="typical_title_1 flex_row centered">
                            <div class="flex_100">
                                Campo n¬∫ {{ bloqueIndex + 1 }}. {{ bloque.id }}
                            </div>
                            <div class="flex_1">
                                <button class="supermini"
                                    v-on:click="() => toggleCampo(bloqueIndex)">
                                    <span v-if="campos_escondidos.indexOf(bloqueIndex) === -1">‚ûñ</span>
                                    <span v-else>‚ûï</span>
                                </button>
                            </div>
                        </div>
                        <div class="metaformulario_de_campo_de"
                            v-show="campos_escondidos.indexOf(bloqueIndex) === -1">
                            <hr />
                            <!--div class="">{{ bloque }}</div-->
                            <div class="pad_top_2">
                                <div class="pad_bottom_1">‚ùì Tipo del campo:</div>
                                <select class="supermini width_100"
                                    v-on:change="v => setBloqueValue(bloqueIndex, 'tipo', v.target.value)"
                                    :value="bloque.tipo">
                                    <option value="interludio">Interludio</option>
                                    <option value="texto">Texto</option>
                                    <option value="p√°rrafo">P√°rrafo</option>
                                    <option value="n√∫mero">N√∫mero</option>
                                    <option value="fecha">Fecha</option>
                                    <option value="duraci√≥n">Duraci√≥n</option>
                                    <option value="opci√≥n">Opci√≥n √∫nica</option>
                                    <option value="opciones">Opciones m√∫ltiples</option>
                                </select>
                            </div>
                            <hr />
                            <template v-if="bloque.tipo !== 'interludio'">
                                <div class="pad_top_2">
                                    <div class="pad_bottom_1">‚ùì Identificador del campo:</div>
                                    <input class="supermini width_100"
                                        type="text"
                                        v-on:input="(v) => setBloqueValue(bloqueIndex, 'id', v.target.value)"
                                        placeholder="Ej: nombre_de_usuario"
                                        :value="bloque.id" />
                                </div>
                                <hr />
                                <div class="pad_top_2">
                                    <div class="pad_bottom_1">‚ùì Pregunta del campo:</div>
                                    <input class="supermini width_100"
                                        type="text"
                                        v-on:input="(v) => setBloqueValue(bloqueIndex, 'pregunta', v.target.value)"
                                        placeholder="Ej: ¬øC√≥mo te llamas?"
                                        :value="bloque.pregunta" />
                                </div>
                                <hr />
                                <div class="pad_top_2">
                                    <div class="pad_bottom_1">‚ùì Descripci√≥n del campo:</div>
                                    <textarea class="supermini"
                                        v-on:input="(v) => setBloqueValue(bloqueIndex, 'descripcion', v.target.value)"
                                        spellcheck="false"
                                        placeholder="Ej: Aqu√≠ va el nombre y apellidos del usuario."
                                        :value="bloque.descripcion"></textarea>
                                </div>
                                <hr />
                                <div class="pad_top_2 cursor_pointer">
                                    <div class="pad_bottom_1">‚ùì Opcionalidad del campo:</div>
                                    <div class=""
                                        v-on:click="() => setBloqueValue(bloqueIndex, 'requerido', !bloque.requerido)">
                                        <div v-if="bloque.requerido">‚úÖ Es requerido</div>
                                        <div v-else>üü© No es requerido</div>
                                    </div>
                                </div>
                                <template v-if="['opci√≥n', 'opciones'].indexOf(bloque.tipo) !== -1">
                                    <hr />
                                    <div>
                                        <div class="pad_top_2">
                                            <div class="pad_bottom_1">‚ùì Opciones del campo:</div>
                                            <div v-for="opcion, opcionIndex in bloque.opciones"
                                                v-bind:key="'campo_' + bloqueIndex + '_opcion_' + opcionIndex">
                                                <div class="flex_row pad_bottom_1">
                                                    <div class="flex_100">
                                                        <input class="supermini width_100"
                                                            type="text"
                                                            :value="opcion"
                                                            v-on:input="v => changeOpcionBloque(bloqueIndex, opcionIndex, v)" />
                                                    </div>
                                                    <div class="flex_1 pad_left_1">
                                                        <button class="supermini"
                                                            v-on:click="() => removeOpcionBloque(bloqueIndex, opcionIndex)">‚ùå</button>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="">
                                                <button class="supermini width_100"
                                                    v-on:click="() => addOpcionBloque(bloqueIndex)">‚ûï A√±adir opci√≥n</button>
                                            </div>
                                        </div>
                                    </div>
                                </template>
                                <hr />
                                <div v-if="['texto', 'p√°rrafo', 'n√∫mero', 'duraci√≥n', 'fecha'].indexOf(bloque.tipo) !== -1">
                                    <div class="pad_top_2">
                                        <div class="pad_bottom_1">‚ùì Texto de relleno del campo:</div>
                                        <textarea class="supermini"
                                            v-on:input="(v) => setBloqueValue(bloqueIndex, 'relleno', v.target.value)"
                                            spellcheck="false"
                                            placeholder="Ej: Pepito de los Palotes"
                                            :value="bloque.relleno"></textarea>
                                    </div>
                                </div>
                                <hr />
                                <div>
                                    <div class="pad_top_2">
                                        <div class="pad_bottom_1">‚ùì Condicional del campo:</div>
                                        <textarea class="supermini"
                                            v-on:input="(v) => setBloqueValue(bloqueIndex, 'condicional', v.target.value)"
                                            spellcheck="false"
                                            placeholder="Ej: formulario.es_hombre && (parseInt(formulario.edad) >= 18)"
                                            :value="bloque.condicional"></textarea>
                                    </div>
                                </div>
                                <hr />
                                <div>
                                    <div class="pad_top_2">
                                        <div class="pad_bottom_1">‚ùì Validador del campo:</div>
                                        <textarea class="supermini"
                                            v-on:input="(v) => setBloqueValue(bloqueIndex, 'validador', v.target.value)"
                                            spellcheck="false"
                                            placeholder="Ej: formulario.es_hombre && (parseInt(formulario.edad) >= 18)"
                                            :value="bloque.validador"></textarea>
                                    </div>
                                </div>
                            </template>
                            <template v-if="bloque.tipo === 'interludio'">
                                <div class="pad_top_2">
                                    <div class="pad_bottom_1">‚ùì Contenido del interludio:</div>
                                    <textarea class="supermini"
                                        v-on:input="(v) => setBloqueValue(bloqueIndex, 'interludio', v.target.value)"
                                        spellcheck="false"
                                        placeholder="Ej: # Secci√≥n 1\n\nExplicaci√≥n de la secci√≥n."
                                        :value="bloque.interludio"></textarea>
                                </div>
                            </template>
                        </div>
                    </div>
                    <div class="flex_1 pad_left_1">
                        <button class="supermini height_100"
                            v-on:click="() => removeBloqueFromFormulario(bloqueIndex)">‚ùå</button>
                    </div>
                </div>
            </div>
            <div class="">
                <button class="supermini width_100"
                    v-on:click="addBloqueToFormulario">‚ûï</button>
            </div>
        </div>
        <div class="pad_1"
            v-if="selectedEditorSubpage === 'codigo'">
            <textarea class="textarea_de_editor"
                :style="getEditorHeightForStyles()"
                v-model="codigo_de_formulario"></textarea>
        </div>
    </template>
    <div v-else-if="selectedPage === 'formulario'"
        class="color_white">
        <div class="typical_title_1 flex_row centered">
            <div class="flex_100">
                üìã Cumplimentaci√≥n de formulario
            </div>
            <div class="flex_1">
                <button class="supermini"
                    v-on:click="() => selectPage('editor')">
                    <span>‚¨ÖÔ∏è üìê</span>
                </button>
            </div>
            <div class="flex_1 pad_left_1">
                <button class="supermini"
                    v-on:click="() => selectPage('respuestas')">
                    <span>üì∏ ‚û°Ô∏è</span>
                </button>
            </div>
        </div>
        <div class="pad_1">
            <div class=""
                v-for="formItem, formItemIndex in formulario"
                v-bind:key="'form_item_' + formItemIndex">
                <template v-if="evaluateCondicional(formItem)">
                    <div class="pad_1 capa_de_interludio"
                        v-if="formItem.tipo === 'interludio'">
                        <lsw-markdown-viewer :source="formItem.interludio"
                            :activate-ejs="true" />
                    </div>
                    <template v-else>
                        <div class="pad_1 pad_bottom_0">
                            <span v-if="(typeof respuestas[formItem.id] === 'undefined') || (respuestas[formItem.id] === '')"> ‚ö™Ô∏è {{
                                formItemIndex + 1 }}. {{ formItem.pregunta }} </span>
                            <span v-else> üü† {{ formItemIndex + 1 }}. {{ formItem.pregunta }} </span>
                            <span class="cursor_pointer"
                                v-on:click="() => {toggleDescripcion(formItemIndex)}"> ‚ÑπÔ∏è </span>
                            <span class="descripcion_de_pregunta"
                                v-if="descripciones_desplegadas.indexOf(formItemIndex) !== -1"> {{ formItem.descripcion }}</span>
                        </div>
                        <div class="pad_1">
                            <div class=""
                                v-if="formItem.tipo === 'texto'">
                                <input class="supermini width_100"
                                    type="text"
                                    v-model="respuestas[formItem.id]"
                                    spellcheck="false" />
                            </div>
                            <div class=""
                                v-else-if="formItem.tipo === 'p√°rrafo'">
                                <textarea class="supermini width_100"
                                    type="text"
                                    v-model="respuestas[formItem.id]"
                                    spellcheck="false"></textarea>
                            </div>
                            <div class=""
                                v-else-if="formItem.tipo === 'n√∫mero'">
                                <input class="supermini width_100"
                                    type="number"
                                    v-model="respuestas[formItem.id]"
                                    spellcheck="false" />
                            </div>
                            <div class=""
                                v-else-if="formItem.tipo === 'fecha'">
                                <input class="supermini width_100"
                                    type="text"
                                    v-model="respuestas[formItem.id]"
                                    spellcheck="false" />
                                <div class="pad_top_1">
                                    <lsw-calendario modo="date"
                                        :al-cambiar-valor="(v, comp) => propagateCalendarioValue(formItem, v, comp)" />
                                </div>
                            </div>
                            <div class=""
                                v-else-if="formItem.tipo === 'duraci√≥n'">
                                <input class="supermini width_100"
                                    type="text"
                                    v-model="respuestas[formItem.id]"
                                    spellcheck="false" />
                            </div>
                            <div class=""
                                v-else-if="formItem.tipo === 'opci√≥n'">
                                <select class="supermini width_100" v-model="respuestas[formItem.id]">
                                    <template v-for="opcion, opcionIndex in formItem.opciones">
                                        <option v-bind:key="'bloque_' + formItemIndex + '_opcion_' + opcionIndex"
                                            :value="opcion">{{ opcionIndex + 1 }}. {{ opcion }}</option>
                                    </template>
                                </select>
                            </div>
                            <div class=""
                                v-else-if="formItem.tipo === 'opciones'">
                                <template v-for="opcion, opcionIndex in formItem.opciones">
                                    <label v-bind:key="'bloque_' + formItemIndex + '_opcion_' + opcionIndex">
                                        <input type="checkbox"
                                            :value="Array.isArray(respuestas[formItem.id]) && (respuestas[formItem.id].indexOf(opcion) !== -1)"
                                            v-on:click="() => propagateOpcionesValue(formItem, opcion, this)"/>
                                            <span style="margin-top: -2px;">{{ opcionIndex + 1 }}. {{ opcion }}</span>
                                    </label>
                                </template>
                            </div>
                        </div>
                    </template>
                </template>
            </div>
        </div>
    </div>
    <div v-else-if="selectedPage === 'respuestas'"
        class="color_white">
        <div class="typical_title_1 flex_row centered">
            <div class="flex_100">
                üì∏ Respuestas de formulario
            </div>
            <div class="flex_1">
                <button class="supermini"
                    v-on:click="() => selectPage('formulario')">
                    <span>‚¨ÖÔ∏è üìã</span>
                </button>
            </div>
        </div>
        <div>
            <template v-for="formItem, formItemIndex in formulario">
                <template v-if="(formItem.id in respuestas) && evaluateCondicional(formItem)">
                    <div class="pad_1"
                        v-bind:key="'respuesta_de_formulario_' + formItemIndex">
                        <hr />
                        <div class="pad_bottom_1">
                            <span>
                                <b>{{ formItemIndex + 1 }}. {{ formItem.pregunta }}</b>
                            </span>
                        </div>
                        <div>
                            <span class="" v-if="typeof respuestas[formItem.id] === 'string'"><b>Respuesta: </b> {{ respuestas[formItem.id] }}</span>
                            <span class="" v-else-if="Array.isArray(respuestas[formItem.id])"><b>Respuestas: </b>{{ respuestas[formItem.id].join(", ") }}</span>
                        </div>
                    </div>
                </template>
            </template>
        </div>
    </div>
    <div>
        <!--lsw-console-hooker />
        <lsw-windows-viewer /-->
        <lsw-debugger />
        <lsw-toasts />
        <lsw-dialogs />
    </div>
    <!--lsw-home-bottom-panel />
    <lsw-clockwatcher /-->
    <div style="min-height: 100px;"></div>
</div>